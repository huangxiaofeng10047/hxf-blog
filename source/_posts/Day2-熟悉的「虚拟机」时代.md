---
title: Day2 熟悉的「虚拟机」时代
date: 2021-08-27 17:17:15
tags:
- devops
categories: 
- devops
---

### **早期尚未有微服务概念时，你可能看过以下的机器架构**

- 纵向扩充：透过加大CPU、Memory、Disk等方式，完成资源扩充

  <!--more-->

**※ 这时候，会将多个服务放在同一台虚拟机**

![image-20210830125458481](https://gitee.com/hxf88/imgrepo/raw/master/img/image-20210830125458481.png)

为了节省成本，我们从实体机中切出「虚拟机」，同时让一台「虚拟机」里面运行多个专案或服务，但因为资金不足所以「虚拟机」也无法开太多台，只好选择加大「虚拟机」规格(例如：CPU、Memory、Disk等)，但是这样的情况往往在虚拟机异常时，上面所运行的服务与专案，全数受到影响。

-   横向扩充：增加虚拟机数量

**※ 将多个服务放在同一台虚拟机，同时有备援机器**

![image-20210830125529311](https://gitee.com/hxf88/imgrepo/raw/master/img/image-20210830125529311.png)

為了避免第一個案例的發生，有人改採用另外一種架構「不只有一台虛擬機提供服務，並且每台虛擬機都有各自的備援機器」，當線上服務的機器異常時，可以在短時間切換至「備援機」，以減少因機器異常而導致的影響，甚至透過橫向擴充的方式，實現連線LoadBalance，降低「虛擬機」的Loading。

### 微服務時代

**(一個服務放一台虛擬機，且同時也具有備援機器)**

在第二個例子，如果機器Loading突然衝高，而且沒有完善的Log監控的話，在問題查找時，其實很難知道是哪一個服務發生異常，導致機器資源被占用；也可能同時間多個服務有突發狀況，造成機器Loading衝高，就算「備援機」已經被拉上線，仍無法減輕機器負擔，服務仍呈現不正常的行為，因此產生了一個新興的架構：「微服務時代」，將服務隔離，盡量讓服務不互相影響，並且一個服務就放一台虛擬機，而且同時擁有備援機器。

![image-20210830125558872](https://gitee.com/hxf88/imgrepo/raw/master/img/image-20210830125558872.png)
